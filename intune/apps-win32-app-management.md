---
title: 将 Win32 应用添加到 Microsoft Intune
titlesuffix: ''
description: 了解如何通过 Microsoft Intune 添加、交付和管理 Win32 应用。 本主题概述了 Intune Win32 应用交付和管理功能，以及 Win32 应用疑难解答信息。
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 11/15/2018
ms.topic: article
ms.prod: ''
ms.service: microsoft-intune
ms.technology: ''
ms.assetid: efdc196b-38f3-4678-ae16-cdec4303f8d2
ms.reviewer: mghadial
ms.suite: ems
ms.custom: intune-azure
ms.openlocfilehash: 8e152e3dc5bc42545bf8bee8595b7bbca2fab0eb
ms.sourcegitcommit: 618c3076a7973b3b54ce3038ee007a33aa82efeb
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/16/2018
ms.locfileid: "51830111"
---
# <a name="intune-standalone---win32-app-management-public-preview"></a>Intune 独立版 - Win32 应用管理（公共预览版）

Intune 独立版拥有更强大的 Win32 应用管理功能。 虽然云连接的客户可以使用 Configuration Manager 进行 Win32 应用管理，但只使用 Intune 的客户将拥有更强大的 Win32 业务线 (LOB) 应用管理功能。 本主题概述了 Intune Win32 应用管理功能和疑难解答信息。

## <a name="prerequisites-for-public-preview"></a>公共预览版的先决条件

- Windows 10 版本 1607 或更高版本（企业版）
- Windows 10 客户端需要： 
    - 已联接到 Azure Active Directory (AAD) 或混合 Azure Active Directory，且
    - 在 Intune（MDM 托管）中注册
- 在公共预览版中，Windows 应用程序大小的上限为每个应用 8 GB 

> [!NOTE]
> 我们目前正在测试 Windows 10 版本 1607 的专业版和教育版，欢迎提供反馈意见。


## <a name="prepare-the-win32-app-content-for-upload"></a>准备 Win32 应用内容以进行上传

使用 [Microsoft Intune Win32 应用上传准备工具](https://github.com/Microsoft/Intune-Win32-App-Packaging-Tool)以预处理 Win32 应用。 打包工具将应用程序安装文件转换为 .intunewin 格式。 打包工具还检测 Intune 所需的某些属性，以确定应用程序安装状态。 在应用安装程序文件夹上使用此工具后，你将能够在 Intune 控制台中创建 Win32 应用。

你可以从 GitHub 下载 [Microsoft Intune Win32 应用上传准备工具](https://github.com/Microsoft/Intune-Win32-App-Packaging-Tool)。

### <a name="available-command-line-parameters"></a>可用的命令行参数 

|    **命令行参数**    |    **描述**    |
|:------------------------------:|:----------------------------------------------------------:|
|    `-h`     |    帮助    |
|    `-c <setup_folder>`     |    所有安装程序文件的安装程序文件夹。    |
|   ` -s <setup_file>`     |    安装程序文件（如 setup.exe 或 setup.msi）。    |
|    `-o <output_folder>`     |    生成的 .intunewin 文件的输出文件夹。    |
|    `-q`       |    安静模式    |

### <a name="example-commands"></a>示例命令

|    **示例命令**    |    **描述**    |
|:-----------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|    `IntuneWinAppUtil -h`    |    该命令将显示工具的使用信息。    |
|    `IntuneWinAppUtil -c <setup_folder> -s <source_setup_file> -o <output_folder> <-q>`    |    此命令将从指定的源文件夹和安装文件生成 `.intunewin` 文件。 对于 MSI 安装文件，此工具将检索 Intune 所需的信息。 如果指定了 `-q`，则命令将以安静模式运行；如果输出文件已存在，则将覆盖该命令。 此外，如果输出文件夹不存在，将自动创建该文件夹。    |

生成 .intunewin 文件时，将需要引用的任何文件置于安装程序文件夹的子文件夹中。 然后，使用相对路径引用所需的特定文件。 例如：

安装程序源文件夹：c:\testapp\v1.0<br>
许可证文件：c:\testapp\v1.0\licenses\license.txt

通过使用相对路径 licenses\license.txt 引用 license.txt 文件。

## <a name="create-assign-and-monitor-a-win32-app"></a>创建、分配和监视 Win32 应用

与业务线 (LOB) 应用一样，可以向 Microsoft Intune 添加 Win32 应用。 此类应用通常由内部或第三方编写。 以下步骤提供指导，以帮助将 Windows 应用添加到 Intune。

### <a name="step-1-specify-the-software-setup-file"></a>步骤 1：指定软件安装程序文件

1.  登录到 [Azure 门户](https://portal.azure.com/)。
2.  选择“所有服务” > “Intune”。 Intune 位于“监视 + 管理”部分中。
3.  在“Intune”窗格中，选择“客户端应用” > “应用” > “添加”。
4.  在“添加”应用窗格中，从提供的下拉列表中选择“Windows 应用 (Win32) - 预览版”。

    ![“添加”应用的屏幕截图 - “添加”类型下拉列表框](./media/apps-win32-app-01.png)

### <a name="step-2-upload-the-app-package-file"></a>第 2 步 - 上传应用包文件

1.  在“添加应用”窗格中，选择“应用包文件”以选择一个文件。 随即显示“应用包文件”窗格。

    ![“应用包文件”的屏幕截图](./media/apps-win32-app-02.png)

2.  在“应用包文件”窗格中，选择“浏览”按钮。 然后选择扩展名为 .intunewin 的 Windows 安装文件。
3.  完成后，选择“确定”。

### <a name="step-3-configure-app-information"></a>步骤 3：配置应用信息

1.  在“添加应用”窗格中，选择“应用信息”以配置应用。
2.  在“应用信息”窗格中，配置以下信息。 此窗格中的某些值可能已自动填充。
    - 名称：输入显示在公司门户中的应用的名称。 如果同一应用名称存在两次，则每个应用都将显示在公司门户中。
    - 描述：为应用输入描述。 描述显示在公司门户中。
    - **发布者**：输入应用的发布者名称。
    - **类别**：选择一个或多个内置应用类别，或选择你创建的类别。 “类别”可让用户在浏览公司门户时更轻松地查找应用。
    - 在公司门户中将此应用显示为特色应用：当用户浏览应用时，在公司门户的主页上突出显示此应用。
    - 信息 URL：（可选）输入包含该应用相关信息的网站 URL。 此 URL 显示在公司门户中。
    - 隐私 URL：（可选）输入包含此应用相关隐私信息的网站 URL。 此 URL 显示在公司门户中。
    - 开发者：（可选）输入应用开发者的名称。
    - 所有者：（可选）输入此应用的所有者的名称。 例如，“HR 部门”。
    - 备注：输入与此应用有关的任何备注。
    - 徽标：上传与应用关联的图标。 用户浏览公司门户时，该图标将与应用一同显示。
3.  完成后，选择“确定”。

### <a name="step-4-configure-app-installation-details"></a>步骤 4：配置应用的安装详细信息
1.  在“添加应用”窗格中，选择“程序”以配置应用的安装和删除命令。
2.  添加用于安装应用的完整安装命令行。 

    例如，如果应用文件名为“MyApp123”，请添加以下内容：`msiexec /i “MyApp123.msi”`

3.  添加根据应用的 GUID 卸载应用的完整卸载命令行。 

    例如：`msiexec /x “{12345A67-89B0-1234-5678-000001000000}”`

    > [!NOTE]
    > 可以将 Win32 应用配置为在“用户”或“系统”上下文中安装。 “用户”上下文表示仅指定用户。 “系统”上下文表示 Windows 10 设备的所有用户。
    >
    > 最终用户无需登录设备即可安装 Win32 应用。

4.  完成后，选择“确定”。

### <a name="step-5-configure-app-requirements"></a>第 5 步 - 配置应用要求

1.  在“添加应用”窗格中，选择“要求”以配置设备在安装应用之前必须满足的要求。
2.  在“要求”窗格中，配置以下信息。 此窗格中的某些值可能已自动填充。
    - **操作系统体系结构**：选择安装应用所需的体系结构。
    - **最低操作系统**：选择安装应用所需的最低操作系统。
    - **所需的磁盘空间(MB)**：添加系统驱动器上安装应用所需的可用磁盘空间（可选）。
    - **所需的物理内存(MB)**：添加安装应用所需的物理内存 (RAM)（可选）。
    - **所需的逻辑处理器的最小数**：添加安装应用所需的最小逻辑处理器数（可选）。
    - **所需的最低 CPU 速度 (MHz)**：添加安装应用所需的最低 CPU 速度（可选）。
3.  完成后，选择“确定”。

### <a name="step-6-configure-app-detection-rules"></a>步骤 6：配置应用检测规则

1.  在“添加应用”窗格中，选择“检测规则”以配置检测应用状态的规则。
2.  在“规则格式”字段中，选择检测应用存在性的方式。 可选择手动配置检测规则，或使用自定义脚本检测应用是否存在。 必须至少选择一个检测规则。 

    > [!NOTE]
    > 在“检测规则”窗格中，可选择添加多个规则。 必须满足“所有”规则的条件才能检测应用。

    - **手动配置检测规则** - 可选择以下某个规则类型：
        1.  **MSI** - 基于 MSI 版本检查进行验证。 此选项只能添加一次。 选择此规则类型时，你有两个设置：
            - **MSI 产品代码** - 为应用添加有效的 MSI 产品代码。
            - **MSI 产品版本检查** - 选择“是”，以验证除 MSI 产品代码外的 MSI 产品版本。
        2.  **文件** - 基于文件或文件夹检测、日期、版本或大小进行验证。
            - **路径** - 包含要检测的文件或文件夹的文件夹完整路径。
            - **文件或文件夹** - 要检测的文件或文件夹。
            - **检测方法** - 选择用于验证应用存在的检测方法类型。
            - **与 64 位客户端上的 32 位应用程序相关联** - 选择“是”以展开 64 位客户端上的 32 位上下文中的任何路径环境变量。 选择“否”（默认值），展开 64 位客户端上的 64 位上下文中的任何路径变量。 32 位客户端将始终使用 32 位上下文。
            
            **基于文件的检测示例**
            1.  检查文件是否存在。
         
                ![检测规则窗格的屏幕截图 - 文件存在](./media/apps-win32-app-03.png)
        
            2.  检查文件夹是否存在。
         
                ![检测规则窗格的屏幕截图 - 文件夹存在](./media/apps-win32-app-04.png)
        
        3. **注册表** - 基于值、字符串、整数或版本进行验证。
            - **密钥路径** - 包含要检测的值的注册表项的完整路径。
            - **值名称** - 要检测的注册表值的名称。 如果此值为空，则将对密钥进行检测。 如果检测方法不是文件或文件夹存在，则密钥的（默认）值将用作检测值。
            - **检测方法** - 选择用于验证应用存在的检测方法类型。
            - **与 64 位客户端上的 32 位应用相关联** -选择“是”，搜索 64 位客户端上的 32 位注册表。 选择“否”（默认值），搜索 64 位客户端上的 64 位注册表。 32 位客户端将始终搜索 32 位注册表。
            
            **基于注册表的检测示例**
            1.  检查注册表项是否存在。
            
                ![检测规则窗格的屏幕截图 - 注册表项存在](./media/apps-win32-app-05.png)    
            
            2.  检查注册表值存在（不适用于预览版）。
        
                ![检测规则窗格的屏幕截图 - 注册表值存在](./media/apps-win32-app-06.png)    
        
            3.  检查注册表值字符串是否相等。
        
                ![检测规则窗格的屏幕截图 - 注册表值字符串相等](./media/apps-win32-app-07.png)    
     
    - **使用自定义检测脚本** - 指定将用于检测此应用的 PowerShell 脚本。 
    
        1.  **脚本文件** - 选择将检测客户端上的应用存在的 PowerShell 脚本。 该脚本返回 0 值退出代码时以及将字符串值写入 STDOUT 时，都将检测该应用。
        2.  **在 64 位客户端上以 32 位进程形式运行脚本** - 选择“是”，使用登录的最终用户的凭据运行脚本。 选择“否”（默认值），在系统上下文中运行该脚本。
        3.  **强制执行脚本签名检查** - 选择“是”，验证脚本已由受信任的发布者签名，这将允许脚本在没有显示警告或提示的情况下运行。 该脚本将运行畅通。 选择“否”（默认值），运行无需签名验证的最终用户确认脚本。
    
        Intune sidecar 检查脚本的结果。 读取脚本写入到标准输出 (STDOUT) 流、标准错误 (STDERR) 流和退出代码的值。 如果脚本以非零值退出，则脚本失败，并且应用程序检测状态为“未安装”。 如果退出代码为零，并且 STDOUT 具有数据，则应用程序检测状态为“已安装”。 
    
        > [!NOTE]
        > 脚本以 0 值退出时，脚本执行成功。 第二个输出通道表示检测到应用 - STDOUT 数据表明该应用已在客户端上找到。 我们不会从 STDOUT 中查找特定的字符串。
    
3.  添加应用规则后，请选择“添加” > “确定”。

### <a name="step-7-configure-app-return-codes"></a>第 7 步 - 配置应用返回代码

1.  在“添加应用”窗格中，选择“返回代码”以添加用于指定应用安装重试行为或安装后行为的返回代码。 在创建应用期间默认添加返回代码条目。 但是，可以添加其他返回代码，或更改现有的返回代码。 
2.  在“返回代码”窗格中，添加其他返回代码，或修改现有的返回代码。
    - **失败** - 表示应用安装失败的返回值。
    - **硬重启** - 硬新启返回代码不允许在未重启的情况下在客户端上安装下一个 Win32 应用。 
    - **软重启** - 软重启返回代码允许安装下一个 Win32 应用程序而无需重启客户端。 重启对于完成当前应用安装操作是必要的。
    - **重试** - 重试返回代码代理将尝试三次安装应用。 每次尝试都将等待 5 分钟。 
    - **成功** - 表示应用已成功安装的返回值。
3.  添加或修改返回代码列表后，请选择“确定”。

### <a name="step-8-add-the-app"></a>步骤 8：添加应用

1.  在“添加应用”窗格中，验证是否已正确配置应用信息。
2.  选择“添加”将应用上传到 Intune。

### <a name="step-9-assign-the-app"></a>步骤 9：分配应用

1.  在“应用”窗格中，选择“分配”。
2.  选择“添加组”以打开与该应用相关的“添加组”窗格。
3.  对于特定应用，请选择“分配类型”：
    - **可用于已注册设备**：用户从公司门户应用或公司门户网站安装应用。
    - 必需：应用安装在所选组中的设备上。
    - 卸载：已从所选组中设备上卸载应用。
4.  选择“包括的组”并分配将使用此应用的组。
5.  在“分配”窗格中选择“确定”，完成包括的组选择。
6.  如果想排除受此应用分配影响的任何用户组，请选择“排除组”。
7.  在“添加组”窗格中，选择“确定”。
8.  在应用的“分配”窗格中，选择“保存”。

此时已完成将 Win32 应用添加到 Intune 的步骤。 有关应用分配和监视的详细信息，请参阅[使用 Microsoft Intune 将应用分配到组](https://docs.microsoft.com/intune/apps-deploy)和[使用 Microsoft Intune 监视应用信息和分配](https://docs.microsoft.com/intune/apps-monitor)。

## <a name="install-required-and-available-apps-on-devices"></a>在设备上安装必需和可用应用

最终用户将看到必需和可用应用安装的 Windows Toast 通知。 下图显示了在设备重启之前应用安装还未完成的 toast 通知示例。 

![应用安装的 Windows toast 通知的屏幕截图示例](./media/apps-win32-app-08.png)    

下图会通知最终用户，应用正在对设备进行更改。

![通知最终用户应用正在对设备进行更改的屏幕截图示例](./media/apps-win32-app-09.png)    

## <a name="troubleshoot-win32-app-issues"></a>Win32 应用问题的疑难解答
客户端计算机上的代理日志通常位于 `C:\ProgramData\Microsoft\IntuneManagementExtension\Logs`。 可利用 `CMTrace.exe` 查看这些日志文件。 可从 [SCCM 客户端工具](https://docs.microsoft.com/sccm/core/support/tools)下载 CMTrace.exe。 

![代理日志的屏幕截图](./media/apps-win32-app-10.png)    

### <a name="troubleshooting-areas-to-consider"></a>故障排除需要考虑的方面
- 检查目标以确保设备上已安装代理 - 面向组的 Win32 应用或 PowerShell 脚本将为安全组创建代理安装策略。
- 检查 OS 版本 - Windows 10 1607 及更高版本。  
- 检查 Windows 10 SKU - Windows 10 S 或以 S 模式运行的 Windows 版本不支持 MSI 安装。

## <a name="next-steps"></a>后续步骤

- 有关向 Intune 添加应用的详细信息，请参阅[向 Microsoft Intune 添加应用](apps-add.md)。
